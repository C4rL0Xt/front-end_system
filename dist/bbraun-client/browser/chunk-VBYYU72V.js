import{a as I,b as d,c as S}from"./chunk-5WPLYKXB.js";import{a as v,b as k,c as _,k as l,m as y,q as r}from"./chunk-ZG6KWHQV.js";import{Eb as f,_a as c,ca as u,f as j,ha as g,na as a}from"./chunk-5A5ZOIWX.js";var p=j(I());var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",H=(()=>{let i=class i{constructor(e,o){this.tokenService=e,this.router=o,this.authorize_uri=r.authorize_uri,this.params={client_id:r.client_id,redirect_uri:r.redirect_uri,scope:r.scope,response_type:r.response_type,response_mode:r.response_mode,code_challenge_method:r.code_challenge_method}}ngOnInit(){this.getLogged(),this.tokenService.clear()}ngOnDestroy(){}verifyLoggedOut(){this.router.queryParams.subscribe(e=>{this.isLoggedOut=e.isLoggedOut===!0,this.isLoggedOut&&console.log("El usuario ha cerrado sesi\xF3n correctamente")})}getLogged(){this.isLogged=this.tokenService.isLogged(),this.isAdmin=this.tokenService.isAdmin()}onLogin(){let e=this.generateCodeVerifier();this.tokenService.setVerifier(e),this.params.code_challenge=this.generateCodeChallenge(e);let o=new k({fromObject:this.params}),t=this.authorize_uri+o.toString();location.href=t,console.log("si esta ejecutando")}generateCodeVerifier(){let e="",o=C.length;for(let t=0;t<44;t++)e+=C.charAt(Math.floor(Math.random()*o));return e}generateCodeChallenge(e){return p.SHA256(e).toString(p.enc.Base64).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}};i.\u0275fac=function(o){return new(o||i)(c(d),c(l))},i.\u0275cmp=a({type:i,selectors:[["app-login-page"]],decls:1,vars:0,template:function(o,t){o&1&&f(0,"app-header-main")},dependencies:[S]});let n=i;return n})();var T=(()=>{let i=class i{constructor(e){this.httpClient=e,this.tokne_url=r.token_url}getToken(e,o){let t=new URLSearchParams;t.set("grant_type",r.grant_type),t.set("client_id",r.client_id),t.set("redirect_uri",r.redirect_uri),t.set("scope",r.scope),t.set("code_verifier",o),t.set("code",e);let s="Basic "+btoa("client:secret"),h={headers:new v({"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*",Authorization:s})};return this.httpClient.post(this.tokne_url,t,h)}};i.\u0275fac=function(o){return new(o||i)(g(_))},i.\u0275prov=u({token:i,factory:i.\u0275fac,providedIn:"root"});let n=i;return n})();var J=(()=>{let i=class i{constructor(e,o,t,s){this.activatedRoute=e,this.authService=o,this.tokenService=t,this.router=s,this.code=""}ngOnInit(){this.activatedRoute.queryParams.subscribe(e=>{this.code=e.code;let o=this.tokenService.getVerifier();this.tokenService.deleteVerifier(),this.getToken(this.code,o)})}getToken(e,o){this.authService.getToken(e,o).subscribe(t=>{this.tokenService.setTokens(t.access_token,t.refresh_token);let s=this.extractRolFromToken(t.access_token);this.tokenService.setRolUser(s),this.tokenService.setEmailUser(this.extractEmailFromToken(t.access_token)),this.router.navigate(["/home"])},t=>{console.log(t)})}extractRolFromToken(e){if(e){let t=e.split(".")[1],s=atob(t);return JSON.parse(s).roles||[]}else return null}extractEmailFromToken(e){if(e){let t=e.split(".")[1],s=atob(t);return JSON.parse(s).email||[]}else return null}};i.\u0275fac=function(o){return new(o||i)(c(l),c(T),c(d),c(y))},i.\u0275cmp=a({type:i,selectors:[["app-auth-page"]],decls:0,vars:0,template:function(o,t){}});let n=i;return n})();export{H as a,J as b};
